name: Authentication Worker Deployment
on: 
  push: 
    branches:
      - master
jobs: 
  linux: 
    runs-on: ubuntu-latest
    
    
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v3.6.0
      - name: Creating Config File
        run: |
          echo workers_dev = true > wrangler.toml
          echo 'compatibility_date = "2022-05-23"' >> wrangler.toml
          echo main = build/index.mjs >> wrangler.toml
          echo "[build]" >> wrangler.toml
          echo 'command = "npm run build"' >> wrangler.toml
        shell: bash
      - name: publish
        uses: cloudflare/wrangler-action@2.0.0
        with: 
          apitoken: ${{ secrets.CLOUDFLARE_API_KEY }}
          accountId: ${{ secrets.ACCOUNT_ID }}
        env:
          name: ${{ secrets.NAME }}
          REALM_APPID: $${{ secrets.REALM_APPID }}
        

